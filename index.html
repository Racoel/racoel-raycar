
<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <title>R√°dio Online ‚Äì Racoel Raycar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* Tema claro/escuro autom√°tico */
    :root { color-scheme: light dark; }
    html, body { margin: 0; padding: 0; }
    body {
      font-family: Arial, Helvetica, sans-serif;
      display: grid;
      grid-template-columns: 1fr min(420px, 35%);
      grid-template-rows: auto auto auto 1fr;
      gap: 16px;
      min-height: 100vh;
      background: Canvas;
      color: CanvasText;
    }
    header {
      grid-column: 1 / -1;
      padding: 24px 24px 8px 24px;
      border-bottom: 1px solid color-mix(in oklab, CanvasText 15%, transparent);
    }
    h1 { margin: 0 0 4px 0; font-size: clamp(20px, 2.6vw, 28px); }
    .sub { color: color-mix(in oklab, CanvasText 50%, transparent); font-size: 14px; }

    main { padding: 0 24px 24px 24px; }
    aside { padding: 0 24px 24px 0; }

    /* Info, contador, status */
    #info { font-weight: 600; margin: 8px 0; }
    #contador { color: color-mix(in oklab, CanvasText 50%, transparent); margin: 4px 0; }
    #status { min-height: 1.2em; margin: 6px 0 10px 0; color: #b00020; }

    /* Player + tempo */
    .player-row { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
    #tempo { font-variant-numeric: tabular-nums; color: color-mix(in oklab, CanvasText 40%, transparent); }
    audio { width: min(640px, 100%); }

    /* Bot√µes */
    .controls { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
    button {
      padding: 10px 16px; font-size: 15px; cursor: pointer; border-radius: 8px; border: 1px solid
      color-mix(in oklab, CanvasText 15%, transparent);
      background: color-mix(in oklab, Canvas 92%, CanvasText 8%);
      color: CanvasText;
    }
    button:hover { background: color-mix(in oklab, Canvas 85%, CanvasText 15%); }
    .pill { border-radius: 999px; }
    .secondary { background: transparent; }

    /* Playlist */
    #playlist-title { margin: 16px 0 8px 0; font-size: 16px; font-weight: 700; }
    #playlist {
      list-style: none; padding: 0; margin: 0;
      border: 1px solid color-mix(in oklab, CanvasText 12%, transparent);
      border-radius: 8px; overflow: hidden;
    }
    #playlist li {
      display: grid;
      grid-template-columns: 32px 1fr auto;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-bottom: 1px solid color-mix(in oklab, CanvasText 8%, transparent);
      cursor: pointer;
      background: color-mix(in oklab, Canvas 98%, CanvasText 2%);
    }
    #playlist li:last-child { border-bottom: none; }
    #playlist li:hover { background: color-mix(in oklab, Canvas 92%, CanvasText 8%); }
    #playlist li.playing {
      background: color-mix(in oklab, Canvas 86%, CanvasText 14%);
      outline: 2px solid color-mix(in oklab, CanvasText 18%, transparent);
    }
    .index-num { text-align: right; color: color-mix(in oklab, CanvasText 50%, transparent); }
    .title { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .duration { color: color-mix(in oklab, CanvasText 45%, transparent); font-variant-numeric: tabular-nums; }

    /* Rodap√© simples */
    footer {
      grid-column: 1 / -1;
      padding: 12px 24px;
      border-top: 1px solid color-mix(in oklab, CanvasText 15%, transparent);
      font-size: 12px;
      color: color-mix(in oklab, CanvasText 55%, transparent);
    }
  </style>
</head>
<body>

  <header>
    <h1>R√°dio Racoel Raycar</h1>
    <div class="sub">Reprodu√ß√£o aleat√≥ria, lista clic√°vel, atalhos de teclado e tempo em tempo real.</div>
  </header>

  <main>
    <div id="info">A preparar‚Ä¶</div>
    <div id="contador">Faixas tocadas: 0</div>
    <div id="status"></div>

    <div class="player-row">
      <!-- Oculta a op√ß√£o de download no player -->
      <audio id="player" controls controlsList="nodownload"></audio>
      <div id="tempo">00:00 / --:--</div>
    </div>

    <div class="controls">
      <button id="anterior">‚èÆ Anterior</button>
      <button id="playpause" class="pill">‚èØ Play</button>
      <button id="proxima">Pr√≥xima ‚ñ∂</button>
      <button id="shuffle" class="secondary pill">üîÄ Shuffle: ON</button>
      <!-- Alterna cache busting para testes (desativado por defeito) -->
      <button id="devcache" class="secondary pill">üß™ Cache busting: OFF</button>
    </div>
  </main>

  <aside>
    <div id="playlist-title">Playlist</div>
    <ul id="playlist"></ul>
  </aside>

  <footer>
    ¬© Racoel Raycar ‚Äî R√°dio Online ‚Ä¢ Atalhos: Espa√ßo = Play/Pause, ‚Üê = Anterior, ‚Üí = Pr√≥xima.
  </footer>

  <script>
    /*** CONFIGURA√á√ÉO ***/
    // Alterna para true se quiseres for√ßar recarregamento dos MP3 em testes
    let USE_CACHE_BUSTING = false;

    // Mant√©m esta lista com os Nomes EXATOS dos ficheiros na pasta /audio
    const faixas = [
      "audio/opus16_01_o_teu_nome.mp3",
      "audio/opus16_02_dare.mp3",
      "audio/opus16_03_diacronia.mp3",
      "audio/opus16_04_extraordinary.mp3",
      "audio/opus16_05_diacronia_reprise.mp3",
      "audio/opus16_05_pena_maior.mp3",
      "audio/opus16_06_from_the_top_of_the_eiffel_tower_instrumental.mp3",
      "audio/opus16_07_o_que_a_gente_sente.mp3",
      "audio/opus16_08_se_soubesses.mp3",
      "audio/opus16_09_var8.mp3",
      "audio/opus16_10_para_la_do_tempo.mp3",
      "audio/opus16_11_sunrise_beach_party_instrumental.mp3",
      "audio/opus16_12_mudanca.mp3",
      "audio/opus16_13_batucada.mp3",
      "audio/opus16_14_amores.mp3",
      "audio/opus16_15_pena_maior_take1.mp3",
      "audio/opus16_17_var5.mp3",
      "audio/opus16_18_vvar2.mp3",
      "audio/opus16_22_var7.mp3",
      "audio/opus16_23_var1617.mp3",
      "audio/opus16_24_bonus_track_var1616.mp3",
      "audio/opus16_80_give_me_a_chance.mp3",
      "audio/opus16_81_into_your_eyes.mp3",
      "audio/opus16_82_perto.mp3",
      "audio/opus16_83_tudo_a_ver.mp3",
      "audio/opus16_84_o_lugar.mp3",
      "audio/opus16_85_ligacao.mp3",
      "audio/opus16_85_stop_tune.mp3",
  "audio/opus17_01_took_so_long_reprise.mp3",
  "audio/opus17_02_together_reprise.mp3",
  "audio/opus17_03_seeing_you_instrumental.mp3",
  "audio/opus17_04_liberdade.mp3",
  "audio/opus17_05_together.mp3",
  "audio/opus17_06_all_your_heart_and_mind.mp3",
  "audio/opus17_06_olhei.mp3", // se for mesmo 06, mant√©m; sen√£o ajusta o n√∫mero
  "audio/opus17_07_time_window.mp3",
  "audio/opus17_08_var17.mp3",
  "audio/opus17_09_took_so_long.mp3",
  "audio/opus17_10_var11.mp3",
  "audio/opus17_11_your_enchanting_ways_instrumental.mp3",
  "audio/opus17_12_var10.mp3",
  "audio/opus17_13_pudera_eu.mp3",
  "audio/opus17_14_perfeito.mp3",
  "audio/opus17_15_soft_fresh_ligth_skin_instrumental.mp3",
  "audio/opus17_16_agrilhetado.mp3",
  "audio/opus17_17_var12.mp3",
  "audio/opus17_18_life_spark.mp3",
  "audio/opus17_19_highlights.mp3",
  "audio/opus17_20_var24.mp3",
  "audio/opus17_21_var23.mp3",
  "audio/opus17_22_var14.mp3",
  "audio/opus17_23_var16.mp3",
  "audio/opus17_24_var18.mp3",
  "audio/opus17_25_var19.mp3",
  "audio/opus18_01_vontade_reprise.mp3",
  "audio/opus18_02_your_name_reprise.mp3",
  "audio/opus18_03_atencao.mp3",
  "audio/opus18_04_var44.mp3",
  "audio/opus18_05_ask.mp3",
  "audio/opus18_06_var46.mp3",
  "audio/opus18_07_var47.mp3",
  "audio/opus18_08_var48.mp3",
  "audio/opus18_09_my_only_cry.mp3",
  "audio/opus18_10_var49.mp3",
  "audio/opus18_11_yearning_sea.mp3",
  "audio/opus18_12_var50.mp3",
  "audio/opus18_13_var51.mp3",
  "audio/opus18_14_longiperto.mp3",
  "audio/opus18_15_think_about.mp3",
  "audio/opus18_16_joy.mp3",
  "audio/opus18_17_tell_you.mp3",
  "audio/opus18_18_var52.mp3",
  "audio/opus18_19_var53.mp3",
  "audio/opus18_20_you_know.mp3",
  "audio/opus18_21_one_day.mp3",
  "audio/opus18_22_my_last_song.mp3",
  "audio/opus19_01_i_ve_been_loving_you.mp3",
  "audio/opus19_04_te_voltar_a_ver.mp3",
  "audio/opus19_05_te_voltar_a_ver_instrumental.mp3",
  "audio/opus19_06_eyes_of_the_heart.mp3",
  "audio/opus19_06_let_me_be.mp3",
  "audio/opus19_07_var_1904.mp3",
  "audio/opus19_08_a_mais_bela.mp3",
  "audio/opus19_08_var1905.mp3",
  "audio/opus19_09_longing.mp3",
  "audio/opus19_10_var1906.mp3",
  "audio/opus19_12_no_or_maybe_2.mp3",
  "audio/opus19_12_var1908.mp3",
  "audio/opus19_13_no_or_maybe_3.mp3",
  "audio/opus19_14_var1909.mp3",
  "audio/opus19_15_contigo.mp3",
  "audio/opus19_16_var1910.mp3",
  "audio/opus19_17_sentido.mp3",
  "audio/opus19_18_Contigo_reprise.mp3",
  "audio/opus19_20_wandering_for_you_part1.mp3",
  "audio/opus20_01_prevails.mp3",
  "audio/opus20_08_identification.mp3",
  "audio/opus20_09_inner_flame.mp3",
  "audio/opus20_13_two_of_a_one.mp3",
  "audio/opus20_14_ter_mar.mp3",
  "audio/opus20_15_higher_than_the_skies.mp3",
  "audio/opus20_20_pode_o_mundo_acabar.mp3",
  "audio/opus20_21_var2010.mp3",
  "audio/opus20_23_apoderar.mp3",
  "audio/opus20_24_my_sorow.mp3",
  "audio/opus20_25_a_perfect_love.mp3",
  "audio/opus20_26_i_wish.mp3",
  "audio/opus20_28_uma_vez.mp3",
  "audio/opus20_29_gosto.mp3",
  "audio/opus20_30_faltam_as_palavras.mp3",
  "audio/opus20_31_var2009.mp3",
  "audio/opus20_33_wo_ai_ni.mp3",
  "audio/opus21_01_connected.mp3",
  "audio/opus21_02_masks.mp3",
  "audio/opus21_03_distraught.mp3",
  "audio/opus21_04-var2101.mp3",
   "audio/opus21_05_poets.mp3",
   "audio/opus21_06_var2102.mp3",
   "audio/opus21_07_masks_reprise.mp3",
   "audio/opus21_09_var2103.mp3",
   "audio/opus21_10_doido.mp3",
   "audio/opus21_11_chat_with_you.mp3",
   "audio/opus21_12_var2104.mp3",
   "audio/opus21_13_glory.mp3",
   "audio/opus21_14_var2105.mp3",
   "audio/opus21_15_um_passo.mp3",
   "audio/opus21_16_var2106.mp3",
   "audio/opus21_17_you_know_reprise.mp3",
   "audio/opus21_18_let_me.mp3",
    "audio/opus21_19_never_forget_you.mp3",
    "audio/opus21_20_only_with_you.mp3",
    "audio/opus21_21_n√£o_sei.mp3",
    "audio/opus21_22_the_one.mp3",
    "audio/opus21_23_var2107.mp3",
    "audio/opus21_24_all_in_you.mp3",
    "audio/opus21_25_all_the_way.mp3",
    "audio/opus21_26_i_whisper_your_name.mp3",
    "audio/opus21_27_through_a_million_lives.mp3",
    "audio/opus21_28_wandering_for_you_parte2.mp3",
    "audio/opus21_29_sim.mp3",
"audio/opus22_01_cest_te_voir.mp3",
"audio/opus22_02_var2216.mp3",
"audio/opus22_03_cest_te_voir_reprise.mp3",
"audio/opus22_04_so_lovely.mp3",
"audio/opus22_05_var_2201_fado_assobiado.mp3",
"audio/opus22_07_so_lovely_reprise.mp3",
"audio/opus22_08_o_mundo_inteiro.mp3",
"audio/opus22_09_var2208.mp3",
"audio/opus22_11_be_sure.mp3",
"audio/opus22_12_var2207.mp3",
"audio/opus22_13_before_my_eyes.mp3",
"audio/opus22_14_var2205.mp3",
"audio/opus22_15_embrulhar.mp3",
"audio/opus22_17_goes_through.mp3",
"audio/opus22_18_that_feeling.mp3",
"audio/opus22_19_that_feeling_reprise.mp3",
"audio/opus22_20_we.mp3",
"audio/opus22_21_a_hundred_songs.mp3",
"audio/opus22_22_crashed_and_smashed.mp3",
"audio/opus22_27_caminhando.mp3",
"audio/opus22_29_what_if.mp3",
"audio/opus22_30_worth.mp3",
"audio/opus22_31_why.mp3",
"audio/opus22_32_perfect.mp3",
"audio/opus22_33_var2202.mp3",
"audio/opus22_34_linked.mp3",
"audio/opus22_35_march_beneath_darkening_skies.mp3",
"audio/opus22_44_wandering_for_you_part3.mp3",
"audio/opus22_45_sounddrops_for_the_end.mp3",
"audio/opus23_01_affection_versus_contempt_the_affection_part.mp3",
"audio/opus23_03_e_o_nosso_amor_it_is_our_love_part1.mp3",
"audio/opus23_04_e_o_nosso_amor_it_is_our_love_part2.mp3",
"audio/opus23_10_e_o_nosso_amor_it_is_our_love_part3.mp3",
"audio/opus23_11_e_o_nosso_amor_it_is_our_love_part4.mp3",
"audio/opus23_12_pouring_rain.mp3",
"audio/opus23_13_sempre_a_pensar_em_ti.mp3",
"audio/opus23_14_if_your_love_is_for_me_part1.mp3",
"audio/opus23_14_if_your_love_is_for_me_part2.mp3",
"audio/opus23_15_pouring_rain_reprise.mp3",
"audio/opus23_16_nearing_storm_part1.mp3",
"audio/opus23_17_walking_on_wet_ground.mp3",
"audio/opus23_18_if_your_love_is_for_me_part3.mp3",
"audio/opus23_19_dont_be_blue.mp3",
"audio/opus23_20_cold_nigth.mp3",
"audio/opus23_21_lonely_breakfast.mp3",
"audio/opus23_22_daily_work.mp3",
"audio/opus23_23_affection_versus_contempt_the contempt_part.mp3",
"audio/opus23_24_dont_be_blue-reprise.mp3",
"audio/opus23_25_a_lonely_christmas.mp3",
"audio/opus23_26_all_in_me.mp3",
"audio/opus23_26_steping_on_clouds.mp3",
"audio/opus23_27_all_in_me_reprise.mp3",
"audio/opus23_56_nearing_storm_part2.mp3",
"audio/opus23_57_within_you.mp3",
"audio/opus23_60_e_natal.mp3",
"audio/opus23_81_quando_o_tempo_for_nada.mp3",
"audio/opus23_82_a_poor_man_in_love.mp3",
"audio/opus23_85_quando_o_tempo_for_nada_reprise.mp3",
"audio/opus23_89_what_a_journey.mp3",
"audio/opus23_90_start_and_end_march.mp3",
"audio/opus24_01_for_you.mp3",
"audio/opus24_02_var2401.mp3",
"audio/opus24_02_var2402.mp3",
"audio/opus24_03_in_each_others_arms_part1.mp3",
"audio/opus24_04_in_each_others_arms_part2.mp3",
"audio/opus24_05_in_each_others_arms_part3.mp3",
"audio/opus24_05_var2405.mp3",
"audio/opus24_05_var2412.mp3",
"audio/opus24_06_var2415.mp3",
"audio/opus24_09_var2407.mp3",
"audio/opus24_10_var2404.mp3",
"audio/opus24_11_believe.mp3",
"audio/opus24_13_var2408.mp3",
"audio/opus24_16_beam_of_ligth.mp3",
"audio/opus24_17_lullaby_tune.mp3",
"audio/opus24_18_sempre_foi_assim.mp3",
"audio/opus24_19_var2414.mp3",
"audio/opus24_20_var2406.mp3",
"audio/opus24_21_pancadaria.mp3",
"audio/opus24_21_var2411.mp3",
"audio/opus24_22_so.mp3",
"audio/opus24_23_var2409.mp3",
"audio/opus24_25_jump.mp3",
"audio/opus24_26_a_world_to_be_saved_part1.mp3",
"audio/opus24_27_var2418_sounds_after_the_last_man_died.mp3",
"audio/opus24_28_a_world_to_be_saved_part2.mp3",
"audio/opus24_29_dance_of_souls.mp3",
"audio/opus24_31_some_how.mp3",
"audio/opus24_32_var2417.mp3",
"audio/opus24_33_next_time.mp3",
"audio/opus24_43_nearing_storm_part3.mp3",
"audio/opus24_50_dance_of_souls_reprise.mp3",
"audio/opus25_01_under_other_circumstances.mp3",
"audio/opus25_02_under_other_circumstances_reprise.mp3",
"audio/opus25_03_var2509.mp3",
"audio/opus25_04_my_dear.mp3",
"audio/opus25_05_var2508.mp3",
"audio/opus25_06_my_dear_reprise.mp3",
"audio/opus25_07_var2518.mp3",
"audio/opus25_08_qad_yakun_alsalam_fi_qalbik.mp3",
"audio/opus25_09_var2502.mp3",
"audio/opus25_10_var2503.mp3",
"audio/opus25_11_in_the_end_of_all_times.mp3",
"audio/opus25_12_would_never_end.mp3",
"audio/opus25_13_var2504.mp3",
"audio/opus25_14_var2505.mp3",
"audio/opus25_15_var2519.mp3",
"audio/opus25_16_var2506.mp3",
"audio/opus25_17_var2507.mp3",
"audio/opus25_18_se_torna_a_fonte.mp3",
"audio/opus25_19_nao_passa.mp3",
"audio/opus25_20_i_just_care.mp3",
"audio/opus25_21_var2524.mp3",
"audio/opus26_00_when_i_am_arround.mp3",
  "audio/opus26_01_le_temps_qu_il_faut.mp3",
  "audio/opus26_02_kimi_ga_itooshi.mp3",
  "audio/opus26_03_var2601.mp3",
  "audio/opus26_04_var2602.mp3",
  "audio/opus26_05_var2603.mp3",
  "audio/opus26_06_al_tu_alrededor1.mp3",
  "audio/opus26_07_al_tu_alrededor2.mp3",
  "audio/opus26_08_al_tu_alrededor3.mp3",
  "audio/opus26_09_al_tu_alrededor4.mp3",
  "audio/opus26_10_al_tu_alrededor5.mp3",
  "audio/opus26_11_al_tu_alrededor6.mp3",
  "audio/opus26_12_al_tu_alrededor7.mp3",
  "audio/opus26_14_var2604.mp3",
  "audio/opus26_15_soltar.mp3",
  "audio/opus26_16_var2605.mp3",
  "audio/opus26_17_var2606.mp3",
  "audio/opus26_18_var2607.mp3",
  "audio/opus26_19_my_only_real_love.mp3",
  "audio/opus26_20_my_only_real_love_reprise.mp3",
  "audio/opus26_21_te_namorar.mp3",
  "audio/opus26_22_jail.mp3",
  "audio/opus26_23_opus2608_guilty_for_believe.mp3",
  "audio/opus26_24_var2609.mp3",
  "audio/opus26_25_var2610.mp3",
  "audio/opus26_26_var2611.mp3",
  "audio/opus26_27_into_me1.mp3",
  "audio/opus26_28_into_me2.mp3",
  "audio/opus26_29_into_me3.mp3",
  "audio/opus26_30_var2612.mp3",
  "audio/opus27_01_glimps.mp3",
  "audio/opus27_02_crazy.mp3",
  "audio/opus27_03_couldnt_love_you_more1.mp3",
  "audio/opus27_04_couldnt_love_you_more2.mp3",
  "audio/opus27_05_couldnt_love_you_more3.mp3",
  "audio/opus27_06_do_mundo.mp3",
  "audio/opus27_07_in_my_eyes.mp3",
  "audio/opus27_08_to_live.mp3",
  "audio/opus27_09_to_live_reprise.mp3",
  "audio/opus27_10_sometimes.mp3",
  "audio/opus27_13_call_me1.mp3",
  "audio/opus27_14_call_me2.mp3",
  "audio/opus27_15_call_me3.mp3",
  "audio/opus27_16_call_me4.mp3",
  "audio/opus27_17_call_me5.mp3",
  "audio/opus27_18_calado.mp3",
  "audio/opus27_18_var2701.mp3"
];

    
    /*** ELEMENTOS ***/
    const player = document.getElementById("player");
    const info = document.getElementById("info");
    const contadorDisplay = document.getElementById("contador");
    const status = document.getElementById("status");
    const tempo = document.getElementById("tempo");
    const playlistEl = document.getElementById("playlist");

    const btnPlayPause = document.getElementById("playpause");
    const btnProxima = document.getElementById("proxima");
    const btnAnterior = document.getElementById("anterior");
    const btnShuffle = document.getElementById("shuffle");
    const btnDevCache = document.getElementById("devcache");

    /*** ESTADO ***/
    let shuffleOn = true;
    let fila = [];
    let indiceAtual = -1;
    let contadorFaixas = 0;

    /*** UTILS ***/
    function baralhar(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function nomeAmigavel(path) {
      const nome = path.split("/").pop();
      return nome.replace(/_/g, " ").replace(/\.mp3$/i, "");
    }

    function fmtMMSS(s) {
      if (!isFinite(s) || s < 0) return "--:--";
      const m = Math.floor(s / 60);
      const ss = Math.floor(s % 60);
      return `${String(m).padStart(2, "0")}:${String(ss).padStart(2, "0")}`;
    }

    function comVersao(url) {
      return USE_CACHE_BUSTING ? `${url}?v=${Date.now()}` : url;
    }

    /*** PLAYLIST / FILA ***/
    function construirFila() {
      fila = shuffleOn ? baralhar([...faixas]) : [...faixas];
      indiceAtual = -1;
      renderPlaylist();
    }

    function renderPlaylist() {
      playlistEl.innerHTML = "";
      fila.forEach((f, i) => {
        const li = document.createElement("li");
        li.dataset.index = String(i);
        li.innerHTML = `
          <div class="index-num">${i + 1}</div>
          <div class="title">${nomeAmigavel(f)}</div>
          <div class="duration">--:--</div>
        `;
        if (i === indiceAtual) li.classList.add("playing");
        playlistEl.appendChild(li);

        // tenta pr√©-carregar dura√ß√£o (metadados)
        const a = document.createElement("audio");
        a.preload = "metadata";
        a.src = comVersao(f);
        a.addEventListener("loadedmetadata", () => {
          const d = a.duration;
          const durDiv = li.querySelector(".duration");
          if (durDiv) durDiv.textContent = fmtMMSS(d);
        });
      });
    }

    function destacarAtualNaPlaylist() {
      [...playlistEl.children].forEach(li => li.classList.remove("playing"));
      const atualLi = playlistEl.querySelector(`li[data-index="${indiceAtual}"]`);
      if (atualLi) atualLi.classList.add("playing");
    }

    /*** INFO / UI ***/
    function atualizarInfo() {
      if (indiceAtual >= 0) {
        info.textContent = `Faixa ${indiceAtual + 1} de ${faixas.length}: ${nomeAmigavel(fila[indiceAtual])}`;
      } else {
        info.textContent = "A preparar‚Ä¶";
      }
      contadorDisplay.textContent = `Faixas tocadas: ${contadorFaixas}`;
      btnPlayPause.textContent = player.paused ? "‚èØ Play" : "‚è∏ Pause";
      destacarAtualNaPlaylist();
    }

    /*** REPRODU√á√ÉO ***/
    function setSourceAndPlay(src) {
      player.src = comVersao(src);
      return player.play().catch(err => {
        // Autoplay bloqueado: mostra aviso
        console.warn("Autoplay bloqueado:", err);
        status.textContent = "Autoplay bloqueado ‚Äî clica em ‚èØ Play para iniciar.";
        btnPlayPause.textContent = "‚èØ Play";
      });
    }

    function tocarIndice(i) {
      status.textContent = "";
      if (fila.length === 0) construirFila();
      if (i < 0 || i >= fila.length) return;
      indiceAtual = i;
      setSourceAndPlay(fila[indiceAtual]).then(() => {
        contadorFaixas++;
        atualizarInfo();
      });
    }

    function tocarProxima() {
      status.textContent = "";
      if (fila.length === 0) construirFila();
      indiceAtual++;
      if (indiceAtual >= fila.length) {
        construirFila();
        indiceAtual = 0;
      }
      setSourceAndPlay(fila[indiceAtual]).then(() => {
        contadorFaixas++;
        atualizarInfo();
      });
    }

    function tocarAnterior() {
      status.textContent = "";
      if (fila.length === 0 || indiceAtual <= 0) return;
      indiceAtual--;
      setSourceAndPlay(fila[indiceAtual]).then(() => {
        // por defeito n√£o incrementamos contador ao voltar atr√°s
        atualizarInfo();
      });
    }

    /*** EVENTOS DO PLAYER ***/
    player.addEventListener("ended", tocarProxima);
    player.addEventListener("error", (e) => {
      console.error("Erro no √°udio:", e);
      status.textContent = "Erro ao carregar esta faixa. A avan√ßar para a pr√≥xima‚Ä¶";
      setTimeout(tocarProxima, 400);
    });

    player.addEventListener("timeupdate", () => {
      tempo.textContent = `${fmtMMSS(player.currentTime)} / ${fmtMMSS(player.duration)}`;
    });

    /*** CONTROLOS ***/
    btnProxima.addEventListener("click", tocarProxima);
    btnAnterior.addEventListener("click", tocarAnterior);

    btnPlayPause.addEventListener("click", () => {
      status.textContent = "";
      if (player.paused) {
        player.play().catch(() => {
          status.textContent = "Clica novamente se necess√°rio; alguns navegadores exigem intera√ß√£o.";
        });
      } else {
        player.pause();
      }
      atualizarInfo();
    });

    btnShuffle.addEventListener("click", () => {
      shuffleOn = !shuffleOn;
      btnShuffle.textContent = `üîÄ Shuffle: ${shuffleOn ? "ON" : "OFF"}`;
      // reconstruir a fila mantendo a faixa atual, se existir
      const atual = indiceAtual >= 0 ? fila[indiceAtual] : null;
      construirFila();
      if (atual) {
        const novoIndex = fila.indexOf(atual);
        indiceAtual = novoIndex >= 0 ? novoIndex : -1;
      }
      atualizarInfo();
    });

    btnDevCache.addEventListener("click", () => {
      USE_CACHE_BUSTING = !USE_CACHE_BUSTING;
      btnDevCache.textContent = `üß™ Cache busting: ${USE_CACHE_BUSTING ? "ON" : "OFF"}`;
      status.textContent = USE_CACHE_BUSTING ? "Cache busting ativo para testes." : "";
    });

    // Clique na playlist
    playlistEl.addEventListener("click", (ev) => {
      const li = ev.target.closest("li");
      if (!li) return;
      const idx = Number(li.dataset.index);
      tocarIndice(idx);
    });

    // Atalhos de teclado: Espa√ßo, ‚Üê, ‚Üí
    document.addEventListener("keydown", (e) => {
      if (e.code === "Space") { e.preventDefault(); player.paused ? player.play() : player.pause(); atualizarInfo(); }
      else if (e.code === "ArrowRight") { e.preventDefault(); tocarProxima(); }
      else if (e.code === "ArrowLeft") { e.preventDefault(); tocarAnterior(); }
    });

    /*** INICIALIZA√á√ÉO ***/
    construirFila();
    atualizarInfo();
    // tentar reproduzir a primeira (alguns browsers pedem clique)
    tocarProxima();
  </script>
</body>
</html>
