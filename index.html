
<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <title>R√°dio Online ‚Äì Racoel Raycar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* Tema claro/escuro autom√°tico */
    :root { color-scheme: light dark; }
    html, body { margin: 0; padding: 0; }
    body {
      font-family: Arial, Helvetica, sans-serif;
      display: grid;
      grid-template-columns: 1fr min(420px, 35%);
      grid-template-rows: auto auto auto 1fr;
      gap: 16px;
      min-height: 100vh;
      background: Canvas;
      color: CanvasText;
    }
    header {
      grid-column: 1 / -1;
      padding: 24px 24px 8px 24px;
      border-bottom: 1px solid color-mix(in oklab, CanvasText 15%, transparent);
    }
    h1 { margin: 0 0 4px 0; font-size: clamp(20px, 2.6vw, 28px); }
    .sub { color: color-mix(in oklab, CanvasText 50%, transparent); font-size: 14px; }

    main { padding: 0 24px 24px 24px; }
    aside { padding: 0 24px 24px 0; }

    /* Info, contador, status */
    #info { font-weight: 600; margin: 8px 0; }
    #contador { color: color-mix(in oklab, CanvasText 50%, transparent); margin: 4px 0; }
    #status { min-height: 1.2em; margin: 6px 0 10px 0; color: #b00020; }

    /* Player + tempo */
    .player-row { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
    #tempo { font-variant-numeric: tabular-nums; color: color-mix(in oklab, CanvasText 40%, transparent); }
    audio { width: min(640px, 100%); }

    /* Bot√µes */
    .controls { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
    button {
      padding: 10px 16px; font-size: 15px; cursor: pointer; border-radius: 8px; border: 1px solid
      color-mix(in oklab, CanvasText 15%, transparent);
      background: color-mix(in oklab, Canvas 92%, CanvasText 8%);
      color: CanvasText;
    }
    button:hover { background: color-mix(in oklab, Canvas 85%, CanvasText 15%); }
    .pill { border-radius: 999px; }
    .secondary { background: transparent; }

    /* Playlist */
    #playlist-title { margin: 16px 0 8px 0; font-size: 16px; font-weight: 700; }
    #playlist {
      list-style: none; padding: 0; margin: 0;
      border: 1px solid color-mix(in oklab, CanvasText 12%, transparent);
      border-radius: 8px; overflow: hidden;
    }
    #playlist li {
      display: grid;
      grid-template-columns: 32px 1fr auto;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-bottom: 1px solid color-mix(in oklab, CanvasText 8%, transparent);
      cursor: pointer;
      background: color-mix(in oklab, Canvas 98%, CanvasText 2%);
    }
    #playlist li:last-child { border-bottom: none; }
    #playlist li:hover { background: color-mix(in oklab, Canvas 92%, CanvasText 8%); }
    #playlist li.playing {
      background: color-mix(in oklab, Canvas 86%, CanvasText 14%);
      outline: 2px solid color-mix(in oklab, CanvasText 18%, transparent);
    }
    .index-num { text-align: right; color: color-mix(in oklab, CanvasText 50%, transparent); }
    .title { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .duration { color: color-mix(in oklab, CanvasText 45%, transparent); font-variant-numeric: tabular-nums; }

    /* Rodap√© simples */
    footer {
      grid-column: 1 / -1;
      padding: 12px 24px;
      border-top: 1px solid color-mix(in oklab, CanvasText 15%, transparent);
      font-size: 12px;
      color: color-mix(in oklab, CanvasText 55%, transparent);
    }
  </style>
</head>
<body>

  <header>
    <h1>R√°dio Racoel Raycar</h1>
    <div class="sub">Reprodu√ß√£o aleat√≥ria, lista clic√°vel, atalhos de teclado e tempo em tempo real.</div>
  </header>

  <main>
    <div id="info">A preparar‚Ä¶</div>
    <div id="contador">Faixas tocadas: 0</div>
    <div id="status"></div>

    <div class="player-row">
      <!-- Oculta a op√ß√£o de download no player -->
      <audio id="player" controls controlsList="nodownload"></audio>
      <div id="tempo">00:00 / --:--</div>
    </div>

    <div class="controls">
      <button id="anterior">‚èÆ Anterior</button>
      <button id="playpause" class="pill">‚èØ Play</button>
      <button id="proxima">Pr√≥xima ‚ñ∂</button>
      <button id="shuffle" class="secondary pill">üîÄ Shuffle: ON</button>
      <!-- Alterna cache busting para testes (desativado por defeito) -->
      <button id="devcache" class="secondary pill">üß™ Cache busting: OFF</button>
    </div>
  </main>

  <aside>
    <div id="playlist-title">Playlist</div>
    <ul id="playlist"></ul>
  </aside>

  <footer>
    ¬© Racoel Raycar ‚Äî R√°dio Online ‚Ä¢ Atalhos: Espa√ßo = Play/Pause, ‚Üê = Anterior, ‚Üí = Pr√≥xima.
  </footer>

  <script>
    /*** CONFIGURA√á√ÉO ***/
    // Alterna para true se quiseres for√ßar recarregamento dos MP3 em testes
    let USE_CACHE_BUSTING = false;

    // Mant√©m esta lista com os Nomes EXATOS dos ficheiros na pasta /audio
    const faixas = [
      "audio/opus16_01_o_teu_nome.mp3",
      "audio/opus16_02_dare.mp3",
      "audio/opus16_03_diacronia.mp3",
      "audio/opus16_04_extraordinary.mp3",
      "audio/opus16_05_diacronia_reprise.mp3",
      "audio/opus16_05_pena_maior.mp3",
      "audio/opus16_06_from_the_top_of_the_eiffel_tower_instrumental.mp3",
      "audio/opus16_07_o_que_a_gente_sente.mp3",
      "audio/opus16_08_se_soubesses.mp3",
      "audio/opus16_09_var8.mp3",
      "audio/opus16_10_para_la_do_tempo.mp3",
      "audio/opus16_11_sunrise_beach_party_instrumental.mp3",
      "audio/opus16_12_mudanca.mp3",
      "audio/opus16_13_batucada.mp3",
      "audio/opus16_14_amores.mp3",
      "audio/opus16_15_pena_maior_take1.mp3",
      "audio/opus16_17_var5.mp3",
      "audio/opus16_18_vvar2.mp3",
      "audio/opus16_22_var7.mp3",
      "audio/opus16_23_var1617.mp3",
      "audio/opus16_24_bonus_track_var1616.mp3",
      "audio/opus16_80_give_me_a_chance.mp3",
      "audio/opus16_81_into_your_eyes.mp3",
      "audio/opus16_82_perto.mp3",
      "audio/opus16_83_tudo_a_ver.mp3",
      "audio/opus16_84_o_lugar.mp3",
      "audio/opus16_85_ligacao.mp3",
      "audio/opus16_85_stop_tune.mp3",
"audio/opus17_01_took_so_long_reprise.mp3",
  "audio/opus17_02_together_reprise.mp3",
  "audio/opus17_03_seeing_you_instrumental.mp3",
  "audio/opus17_04_liberdade.mp3",
  "audio/opus17_05_together.mp3",
  "audio/opus17_06_all_your_heart_and_mind.mp3",
  "audio/opus17_06_olhei.mp3", // se for mesmo 06, mant√©m; sen√£o ajusta o n√∫mero
  "audio/opus17_07_time_window.mp3",
  "audio/opus17_08_var17.mp3",
  "audio/opus17_09_took_so_long.mp3",
  "audio/opus17_10_var11.mp3",
  "audio/opus17_11_your_enchanting_ways_instrumental.mp3",
  "audio/opus17_12_var10.mp3",
  "audio/opus17_13_pudera_eu.mp3",
  "audio/opus17_14_perfeito.mp3",
  "audio/opus17_15_soft_fresh_light_skin_instrumental.mp3",
  "audio/opus17_16_agrilhetado.mp3",
  "audio/opus17_17_var12.mp3",
  "audio/opus17_18_life_spark.mp3",
  "audio/opus17_19_highlights.mp3",
  "audio/opus17_20_var24.mp3",
  "audio/opus17_21_var23.mp3",
  "audio/opus17_22_var14.mp3",
  "audio/opus17_23_var16.mp3",
  "audio/opus17_24_var18.mp3",
  "audio/opus17_25_var19.mp3",
      

  "audio/vontade_reprise.mp3",
  "audio/opus18_02_your_name_reprise.mp3",
  "audio/opus18_03_atencao.mp3",
  "audio/opus18_04_var44.mp3",
  "audio/opus18_05_ask.mp3",
  "audio/opus18_06_var46.mp3",
  "audio/opus18_07_var47.mp3",
  "audio/opus18_08_var48.mp3",
  "audio/opus18_09_my_only_cry.mp3",
  "audio/opus18_10_var49.mp3",
  "audio/opus18_11_yearning_sea.mp3",
  "audio/opus18_12_var50.mp3",
  "audio/opus18_13_var51.mp3",
  "audio/opus18_14_longiperto.mp3",
  "audio/opus18_15_think_about.mp3",
  "audio/opus18_16_joy.mp3",
  "audio/opus18_17_tell_you.mp3",
  "audio/opus18_18_var52.mp3",
  "audio/opus18_19_var53.mp3",
  "audio/opus18_20_you_know.mp3",
  "audio/opus18_21_one_day.mp3",
  "audio/opus18_22_my_last_song.mp3"
    ];

    /*** ELEMENTOS ***/
    const player = document.getElementById("player");
    const info = document.getElementById("info");
    const contadorDisplay = document.getElementById("contador");
    const status = document.getElementById("status");
    const tempo = document.getElementById("tempo");
    const playlistEl = document.getElementById("playlist");

    const btnPlayPause = document.getElementById("playpause");
    const btnProxima = document.getElementById("proxima");
    const btnAnterior = document.getElementById("anterior");
    const btnShuffle = document.getElementById("shuffle");
    const btnDevCache = document.getElementById("devcache");

    /*** ESTADO ***/
    let shuffleOn = true;
    let fila = [];
    let indiceAtual = -1;
    let contadorFaixas = 0;

    /*** UTILS ***/
    function baralhar(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function nomeAmigavel(path) {
      const nome = path.split("/").pop();
      return nome.replace(/_/g, " ").replace(/\.mp3$/i, "");
    }

    function fmtMMSS(s) {
      if (!isFinite(s) || s < 0) return "--:--";
      const m = Math.floor(s / 60);
      const ss = Math.floor(s % 60);
      return `${String(m).padStart(2, "0")}:${String(ss).padStart(2, "0")}`;
    }

    function comVersao(url) {
      return USE_CACHE_BUSTING ? `${url}?v=${Date.now()}` : url;
    }

    /*** PLAYLIST / FILA ***/
    function construirFila() {
      fila = shuffleOn ? baralhar([...faixas]) : [...faixas];
      indiceAtual = -1;
      renderPlaylist();
    }

    function renderPlaylist() {
      playlistEl.innerHTML = "";
      fila.forEach((f, i) => {
        const li = document.createElement("li");
        li.dataset.index = String(i);
        li.innerHTML = `
          <div class="index-num">${i + 1}</div>
          <div class="title">${nomeAmigavel(f)}</div>
          <div class="duration">--:--</div>
        `;
        if (i === indiceAtual) li.classList.add("playing");
        playlistEl.appendChild(li);

        // tenta pr√©-carregar dura√ß√£o (metadados)
        const a = document.createElement("audio");
        a.preload = "metadata";
        a.src = comVersao(f);
        a.addEventListener("loadedmetadata", () => {
          const d = a.duration;
          const durDiv = li.querySelector(".duration");
          if (durDiv) durDiv.textContent = fmtMMSS(d);
        });
      });
    }

    function destacarAtualNaPlaylist() {
      [...playlistEl.children].forEach(li => li.classList.remove("playing"));
      const atualLi = playlistEl.querySelector(`li[data-index="${indiceAtual}"]`);
      if (atualLi) atualLi.classList.add("playing");
    }

    /*** INFO / UI ***/
    function atualizarInfo() {
      if (indiceAtual >= 0) {
        info.textContent = `Faixa ${indiceAtual + 1} de ${faixas.length}: ${nomeAmigavel(fila[indiceAtual])}`;
      } else {
        info.textContent = "A preparar‚Ä¶";
      }
      contadorDisplay.textContent = `Faixas tocadas: ${contadorFaixas}`;
      btnPlayPause.textContent = player.paused ? "‚èØ Play" : "‚è∏ Pause";
      destacarAtualNaPlaylist();
    }

    /*** REPRODU√á√ÉO ***/
    function setSourceAndPlay(src) {
      player.src = comVersao(src);
      return player.play().catch(err => {
        // Autoplay bloqueado: mostra aviso
        console.warn("Autoplay bloqueado:", err);
        status.textContent = "Autoplay bloqueado ‚Äî clica em ‚èØ Play para iniciar.";
        btnPlayPause.textContent = "‚èØ Play";
      });
    }

    function tocarIndice(i) {
      status.textContent = "";
      if (fila.length === 0) construirFila();
      if (i < 0 || i >= fila.length) return;
      indiceAtual = i;
      setSourceAndPlay(fila[indiceAtual]).then(() => {
        contadorFaixas++;
        atualizarInfo();
      });
    }

    function tocarProxima() {
      status.textContent = "";
      if (fila.length === 0) construirFila();
      indiceAtual++;
      if (indiceAtual >= fila.length) {
        construirFila();
        indiceAtual = 0;
      }
      setSourceAndPlay(fila[indiceAtual]).then(() => {
        contadorFaixas++;
        atualizarInfo();
      });
    }

    function tocarAnterior() {
      status.textContent = "";
      if (fila.length === 0 || indiceAtual <= 0) return;
      indiceAtual--;
      setSourceAndPlay(fila[indiceAtual]).then(() => {
        // por defeito n√£o incrementamos contador ao voltar atr√°s
        atualizarInfo();
      });
    }

    /*** EVENTOS DO PLAYER ***/
    player.addEventListener("ended", tocarProxima);
    player.addEventListener("error", (e) => {
      console.error("Erro no √°udio:", e);
      status.textContent = "Erro ao carregar esta faixa. A avan√ßar para a pr√≥xima‚Ä¶";
      setTimeout(tocarProxima, 400);
    });

    player.addEventListener("timeupdate", () => {
      tempo.textContent = `${fmtMMSS(player.currentTime)} / ${fmtMMSS(player.duration)}`;
    });

    /*** CONTROLOS ***/
    btnProxima.addEventListener("click", tocarProxima);
    btnAnterior.addEventListener("click", tocarAnterior);

    btnPlayPause.addEventListener("click", () => {
      status.textContent = "";
      if (player.paused) {
        player.play().catch(() => {
          status.textContent = "Clica novamente se necess√°rio; alguns navegadores exigem intera√ß√£o.";
        });
      } else {
        player.pause();
      }
      atualizarInfo();
    });

    btnShuffle.addEventListener("click", () => {
      shuffleOn = !shuffleOn;
      btnShuffle.textContent = `üîÄ Shuffle: ${shuffleOn ? "ON" : "OFF"}`;
      // reconstruir a fila mantendo a faixa atual, se existir
      const atual = indiceAtual >= 0 ? fila[indiceAtual] : null;
      construirFila();
      if (atual) {
        const novoIndex = fila.indexOf(atual);
        indiceAtual = novoIndex >= 0 ? novoIndex : -1;
      }
      atualizarInfo();
    });

    btnDevCache.addEventListener("click", () => {
      USE_CACHE_BUSTING = !USE_CACHE_BUSTING;
      btnDevCache.textContent = `üß™ Cache busting: ${USE_CACHE_BUSTING ? "ON" : "OFF"}`;
      status.textContent = USE_CACHE_BUSTING ? "Cache busting ativo para testes." : "";
    });

    // Clique na playlist
    playlistEl.addEventListener("click", (ev) => {
      const li = ev.target.closest("li");
      if (!li) return;
      const idx = Number(li.dataset.index);
      tocarIndice(idx);
    });

    // Atalhos de teclado: Espa√ßo, ‚Üê, ‚Üí
    document.addEventListener("keydown", (e) => {
      if (e.code === "Space") { e.preventDefault(); player.paused ? player.play() : player.pause(); atualizarInfo(); }
      else if (e.code === "ArrowRight") { e.preventDefault(); tocarProxima(); }
      else if (e.code === "ArrowLeft") { e.preventDefault(); tocarAnterior(); }
    });

    /*** INICIALIZA√á√ÉO ***/
    construirFila();
    atualizarInfo();
    // tentar reproduzir a primeira (alguns browsers pedem clique)
    tocarProxima();
  </script>
</body>
</html>
